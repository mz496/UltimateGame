<style>
/* This is all temporary, and should be moved to
an external file once the styling is mostly finalized */

/*.col-md-3,.col-md-4,.col-md-8,.col-md-9 {
  border: 1px solid blue;
}*/

/* Header styles */

.twitter-typeahead,.tt-hint,.tt-input,.tt-dropdown-menu {
  vertical-align: middle;
  width: 100%;
}
.tt-suggestion {
  position: relative;
}
.suggestion-link {
  position:absolute; 
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  /*z-index: 1000000;*/
}
.empty-suggestions {
  margin: 3px 20px;
  color: #999;
  font-style: italic;
}
.input-group {
  margin: auto;
  vertical-align: middle;
  width: 100%;
}
.header {
  height: 100px;
  margin-bottom: 10px;
  display: inline-flex;
}
.homepage-title {
  margin: auto;
}
.search-bar {
  margin: auto;
}
.section-header {
  margin: 5px 20px;
  padding: 3px 0;
  border-bottom: 1px solid #ccc;
}

/* Body styles */

.col-md-9,.col-md-4 {
  padding: 5px;
}

.game-img,.package-img {
  width: 100%;
}

/* New Deals line styling */

h3.divider {
  width: 100%;
  text-align: center;
  border-bottom: 1px solid #000;
  line-height: 0.1em;
  margin: 10px 0 20px;
} 
span.divider {
  background: #fff;
  padding: 0 10px;
}

/* Package styling */

.vertical-spacer {
  background-color: #333;
  text-align: center;
}
.vertical-spacer-text {
  /*line-height: 29px; <-- assigned dynamically in js */
  white-space: nowrap;
  opacity: 0.5;
  color: #fff;
  text-align: center;
}
.package-link:hover {
  text-decoration: none;
}

</style>

<div class="col-md-12 header">
  <div class="col-md-4 homepage-title">
    <h1>Home Page</h1>
  </div>

  <div class="col-md-8 search-bar">
    <%= form_tag "/get_game", method: :get do %>
      <div class="input-group">
        <% if params[:query].present? %>
          <div class="input-group-btn">
            <%= link_to "clear", "/", class: "btn btn-default" %>
          </div>
        <% end %>
        <%= text_field_tag :query, params[:query], class: "form-control typeahead", id: "game_search", autocomplete: "off" %>
        <div class="input-group-btn">
          <%= submit_tag "Search", class: "btn btn-primary" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<div class="col-md-12">
  <div class="col-md-9">
    <% if @large_capsules != [] %>
      <% @large_capsules.each do |capsule| %>

        <% if Game.find_by(steamid:capsule) %>
          <div class="col-md-4">
            <% if Game.find_by(steamid:capsule).headerimg %>
              <a href="http://store.steampowered.com/app/<%= Game.find_by(steamid:capsule).steamid %>">
              <img src="<%= Game.find_by(steamid:capsule).headerimg %>" class="game-img" />
              </a>
            <% else %>
              <%= image_tag "steamlogo.jpg", class: "game-img" %>
              <!--p><%= Game.find_by(steamid:capsule).name %></p-->
            <% end %>
          </div>

        <% elsif Package.find_by(packageid:capsule) %>
          <div class="col-md-4">
            <% if Package.find_by(packageid:capsule).headerimg %>
              <a class="package-link" href="http://store.steampowered.com/app/<%= Game.find_by(id:Package.find_by(packageid:capsule).game_id).steamid %>">
              <img src="<%= Package.find_by(packageid:capsule).headerimg %>" class="package-img" />

              <div class="vertical-spacer">
              <span class="vertical-spacer-text">PACKAGE</span>
              </div>
              </a>

            <% else %>
              <%= image_tag "steamlogo.jpg", class: "package-img" %>
              <!--p><%= Package.find_by(packageid:capsule).name %></p-->
            <% end %>
          </div>
        <% end %>

      <% end %>
    <% end %>
  </div>

  <div class="col-md-9">
  <h3 class="divider"><span class="divider">New Deals</span></h3>
  </div>

  <div class="col-md-9">
    <% if @new_releases != [] %>
      <% @new_releases.each do |capsule| %>
        
        <% if Game.find_by(steamid:capsule) %>
          <div class="col-md-4">
            <% if Game.find_by(steamid:capsule).headerimg %>
              <a href="http://store.steampowered.com/app/<%= Game.find_by(steamid:capsule).steamid %>">
              <img src="<%= Game.find_by(steamid:capsule).headerimg %>" class="game-img" />
              </a>
            <% else %>
              <%= image_tag "steamlogo.jpg", class: "game-img" %>
              <!--p><%= Game.find_by(steamid:capsule).name %></p-->
            <% end %>
          </div>

        <% elsif Package.find_by(packageid:capsule) %>
          <div class="col-md-4">
            <% if Package.find_by(packageid:capsule).headerimg %>
              <a class="package-link" href="http://store.steampowered.com/app/<%= Game.find_by(id:Package.find_by(packageid:capsule).game_id).steamid %>">
              <img src="<%= Package.find_by(packageid:capsule).headerimg %>" class="package-img" />

              <div class="vertical-spacer">
              <span class="vertical-spacer-text">PACKAGE</span>
              </div>
              </a>

            <% else %>
              <%= image_tag "steamlogo.jpg", class: "package-img" %>
              <!--p><%= Package.find_by(packageid:capsule).name %></p-->
            <% end %>
          </div>
        <% end %>

      <% end %>
    <% end %>
  </div>

</div>

<script>
// hacky: this eliminates the height difference between game header img height and package image height
$(document).ready(function() {
  var test_game_existence = $(".game-img").first();
  var test_package_existence = $(".package-img").first();

  if (test_game_existence != null && test_package_existence != null) {
    var game_height = test_game_existence.css("height").replace("px","");
    var package_height = test_package_existence.css("height").replace("px","");
    var final_height = game_height-package_height + "px"
    $(".vertical-spacer").css("height", final_height);
    $(".vertical-spacer-text").css("line-height", final_height);
  }
}());
</script>
